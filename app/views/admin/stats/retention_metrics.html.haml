%html
  %h2 Loomio retention calculator v0.1
  %p
    This table shows the key group metrics for each month. So for instance, in the March row, you can see
    %ul
      %li
        how many parent groups were
        %strong acquired
        (created sometime in March)
      %li
        how many were
        %strong activated
        (invited multiple people)
      %li
        how many of them were
        %strong retained 30 days
        (had new comments any time after April 1)
      %li
        and how many were
        %strong retained 90 days
        (had new comments any time after June 1)

  %h2 Disclaimers
  %p
    This is the first iteration of a retention calculator, and will need improvement. Specifically:
    %ul
      %li A group created on March 31st and active on April 1st currently meets the definition of 'retained'.
      %li A group with new proposals but no new comments will not meet the definition of 'retained'.
      %li The R30 for March should tell you how many groups created in March were active <em>in</em> April, but it currently tells you how many were active <em>since</em> April.

  %table
    %tr
      %th Start date
      %th New groups acquired
      %th Trial
      %th Activated
      %th Retained 30 days
      %th Retained 90 days
      %th R30
      %th R90
    - @metrics.each do |m|
      %tr
        %td= m.fetch(:start_date).strftime("%B '%y")
        %td= m.fetch(:acquired_count)
        %td= m.fetch(:trial_count)
        %td= m.fetch(:activated_count)
        %td= m.fetch(:retained_30_count)
        %td= m.fetch(:retained_90_count)
        %td= "#{(m.fetch(:r30) * 100).round(1)}%" 
        %td= "#{(m.fetch(:r90) * 100).round(1)}%"

  %p
    Copying the table into
    = link_to "this google sheet", "https://docs.google.com/spreadsheets/d/1X2ZRjZZPub1H_8__OFMQmg7GZgAeLHGLvbtodsOeAOc/edit#gid=0"
    gives this nice chart:

  %iframe{:src => "//docs.google.com/spreadsheets/d/1X2ZRjZZPub1H_8__OFMQmg7GZgAeLHGLvbtodsOeAOc/gviz/chartiframe?oid=1308190998", height: "585px", width: "1664px"}

